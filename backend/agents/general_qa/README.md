# 通用问答智能体说明文档

## 概述

通用问答智能体是一个基于大语言模型的智能对话助手，能够处理各种类型的问答请求，提供准确、有用的回答。该智能体基于LangGraph框架开发，具备智能路由功能，可以根据用户需求将对话路由到相应的专业智能体。

## 核心功能

### 1. 多类型问答处理
- **事实性问答**：回答关于历史、科学、常识等事实性问题
- **解释性问答**：解释概念、原理、流程等复杂内容
- **建议咨询**：提供生活、工作、学习等方面的建议
- **创意思考**：协助头脑风暴、创意生成等思维活动

### 2. 智能对话管理
- **上下文理解**：保持对话连贯性，理解语境
- **多轮对话**：支持连续对话，记住前面的交流内容
- **意图识别**：自动识别用户问题类型和意图
- **智能路由**：根据用户需求路由到专业智能体

### 3. LangGraph特性
- **状态管理**：使用TypedDict管理对话状态
- **节点化流程**：将对话流程分解为独立的处理节点
- **条件路由**：基于用户意图进行智能路由决策
- **可扩展性**：易于添加新的处理节点和路由规则

## 技术架构

### 对话状态 (ConversationState)
```python
class ConversationState(TypedDict):
    messages: List[Dict[str, Any]]        # 对话消息列表
    current_agent: str                    # 当前处理的智能体
    context: Dict[str, Any]               # 对话上下文
    needs_specialist: bool               # 是否需要专业智能体
    specialist_type: str                  # 专业智能体类型
    user_intent: str                      # 用户意图分类
```

### 处理节点

1. **classify_intent**: 用户意图分类节点
   - 使用LLM分析用户消息
   - 将意图映射到对应的智能体类型

2. **general_response**: 通用回答节点
   - 处理通用问答场景
   - 结合对话历史生成响应

3. **route_to_specialist**: 专业路由节点
   - 将请求路由到对应的专业智能体
   - 提供路由确认信息

4. **update_context**: 上下文更新节点
   - 更新对话上下文信息
   - 维护对话状态

## 使用方法

### API调用示例

```python
import requests

# 基本问答
response = requests.post('http://localhost:8000/api/agents/chat/', {
    'message': '请解释一下人工智能的发展历史',
    'agent_type': 'general_qa'
})

# 多轮对话
response = requests.post('http://localhost:8000/api/agents/chat/', {
    'message': '那么AI的未来发展趋势是什么？',
    'agent_type': 'general_qa',
    'conversation_id': previous_conversation_id
})
```

### 输入参数说明

- **message** (必需): 用户问题或对话内容
- **agent_type**: 智能体类型，固定为 'general_qa'
- **conversation_id**: 对话ID，用于多轮对话

### 输出格式

```json
{
    "conversation_id": 123,
    "response": "详细的回答内容...",
    "agent_type": "general_qa",
    "success": true,
    "execution_time": 2.34,
    "metadata": {
        "intent": "知识问答",
        "complexity": "中等",
        "response_type": "解释性回答"
    }
}
```

## 智能体路由规则

| 关键词类型 | 路由到的智能体 | 示例 |
|------------|----------------|------|
| 发言稿相关 | speech_writer | "帮我写年会发言稿" |
| 新闻稿相关 | news_writer | "写一份产品发布新闻" |
| 公文相关 | official_document | "起草通知公告" |
| 研报相关 | research_report | "市场调研报告" |
| 代码相关 | code_assistant | "Python代码生成" |
| 数据分析 | data_analysis | "数据可视化方案" |

## 支持的问题类型

### 1. 知识问答
- 历史事件："请介绍中国古代四大发明"
- 科学原理："解释一下相对论的基本概念"
- 常识问题："为什么天空是蓝色的？"

### 2. 操作指导
- 技术教程："如何使用Git进行版本控制？"
- 生活技能："怎样做一道简单的家常菜？"
- 学习方法："如何高效学习编程？"

### 3. 分析建议
- 问题分析："这个商业计划有什么优缺点？"
- 决策建议："选择工作时应该考虑哪些因素？"
- 学习规划："制定一个Python学习计划"

### 4. 创意协助
- 头脑风暴："为公司年会活动想几个创意主题"
- 内容创作："帮我想一个有趣的故事开头"
- 解决方案："如何提高团队工作效率？"

## 扩展开发

### 添加新的智能体路由

1. 在 `_classify_intent` 方法中添加新的意图类型
2. 更新意图映射规则
3. 添加相应的关键词识别逻辑

```python
intent_mapping = {
    "new_intent": AgentType.NEW_AGENT_TYPE,
    # 添加新的意图映射
}
```

### 自定义处理节点

1. 在 `_build_graph()` 方法中添加新节点
2. 实现对应的处理函数
3. 更新路由逻辑和边连接

## 性能指标

- **响应时间**：平均 2-5 秒
- **路由准确率**：> 95%
- **并发处理**：支持多用户同时使用
- **可用性**：7x24 小时稳定运行

## 最佳实践

### 提问技巧
1. **明确具体**：问题越具体，回答越准确
2. **提供背景**：适当说明问题背景和目的
3. **分步提问**：复杂问题可以分解为多个小问题
4. **反馈确认**：对回答不满意时可以要求澄清或补充

### 使用建议
1. **合理预期**：理解AI能力边界，不期望完美答案
2. **验证信息**：重要信息建议多方验证
3. **持续对话**：利用多轮对话深入探讨问题
4. **善用路由**：需要专业内容时让系统自动路由

## 限制说明

### 能力限制
- **实时信息**：无法获取最新的实时信息
- **个人隐私**：不处理敏感个人信息
- **专业领域**：某些高度专业化问题需要专家验证
- **情感支持**：不能替代专业心理咨询

### 使用限制
- **请求频率**：避免过于频繁的请求
- **内容合规**：不处理违法、有害内容
- **数据安全**：注意保护敏感信息

## 测试

### 运行测试用例
```bash
python tests/test_general_qa.py
```

### 测试用例覆盖
- 基本问答功能
- 意图识别准确性
- 路由功能测试
- 多轮对话测试
- 错误处理测试

## 部署配置

### 环境变量
- `OPENAI_API_KEY`: OpenAI API密钥
- `DATABASE_URL`: 数据库连接字符串
- `REDIS_URL`: Redis缓存连接

### Django设置
```python
INSTALLED_APPS = [
    # ...
    'agents.general_qa',
]
```

## 更新日志

### v1.3.0 (当前版本)
- 增强了意图识别和智能路由功能
- 集成LangGraph对话流程管理
- 优化了多轮对话状态管理
- 改进了响应格式化和元数据

### v1.2.0
- 增加了智能体路由功能
- 支持专业智能体分发
- 改进了上下文管理

### v1.1.0
- 集成了 LangGraph 对话流程
- 支持多轮对话管理
- 添加了元数据输出

### v1.0.0
- 基础问答功能
- 简单的意图识别
- 基本错误处理